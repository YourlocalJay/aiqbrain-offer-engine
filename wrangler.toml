name = "aiqbrain-offer-engine"
main = "src/worker.ts"
workers_dev = true

compatibility_date = "2025-08-01"

compatibility_flags = ["nodejs_compat"]

## Note: Wrangler auto-detects tsconfig.json; explicit [build].tsconfig not needed

[observability]
enabled = true

[assets]
directory = "public"
binding = "ASSETS"

# Run on colo(s) closest to where the data is used to reduce cold starts and latency
[placement]
mode = "smart"


[vars]
# NOTE: Do not put CPAGrip/OGAds secrets here — use `wrangler secret` (see bottom).
# Safe non-secret fallbacks (API keys are set via `wrangler secret`)
BASE_URL = "https://aiqbrain-offer-engine.jasonhslaughter.workers.dev"
CORS_ALLOW_ORIGIN = "*"
NETWORKS_ENABLED = "ogads,cpagrip"
FALLBACK_ANDROID = "https://aiqengage.com/access"
FALLBACK_IOS     = "https://singingfiles.com/show.php?l=0&u=2427730&id=69234&tracking_id="
FALLBACK_GENERIC = "https://aiqengage.com/access"
GREEN_MAX_MINUTES = "7"  # default threshold for 'GREEN' tier (videos ≤7 min)

# KV namespaces (IDs from
#   npx wrangler kv namespace create REGISTRY
#   npx wrangler kv namespace create LOGS
# )
[[kv_namespaces]]
binding = "REGISTRY"
id = "d33cf5ce1d144d8784002ada07c3f69c"

[[kv_namespaces]]
binding = "LOGS"
id = "7c3eb5b4694b46eb88099c6cc443d915"

# Secrets (set these via Wrangler, not here):
#   # CPAGrip (server-to-server, preferred)
#   #   &key= uses your private API key for the private JSON feed.
#   npx wrangler secret put CPAGRIP_SECRET_KEY
#
#   # CPAGrip (client-side JSON feed, optional — only if you plan to expose it)
#   #   &pubkey= uses your *publisher id* (public), not the secret key.
#   npx wrangler secret put CPAGRIP_PUBLISHER_ID
#
#   # OGAds (optional, only if "ogads" is enabled in NETWORKS_ENABLED)
#   npx wrangler secret put OGADS_API_KEY
